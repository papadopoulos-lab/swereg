<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add diagnosis data to skeleton — add_diagnoses • swereg</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add diagnosis data to skeleton — add_diagnoses"><meta name="description" content="Searches for specific ICD diagnosis codes in Swedish hospital registry data
and adds corresponding boolean variables to the skeleton. Can search in main
diagnoses only or both main and secondary diagnoses."><meta property="og:description" content="Searches for specific ICD diagnosis codes in Swedish hospital registry data
and adds corresponding boolean variables to the skeleton. Can search in main
diagnoses only or both main and secondary diagnoses."><meta property="og:image" content="https://papadopoulos-lab.github.io/swereg/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">swereg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">26.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/skeleton-concept.html">Skeleton concept</a></li>
    <li><a class="dropdown-item" href="../articles/rowdep-rowind-concept.html">Variable types: rowdep vs rowind</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Implementation</h6></li>
    <li><a class="dropdown-item" href="../articles/skeleton1-create.html">Building the data skeleton (skeleton1_create)</a></li>
    <li><a class="dropdown-item" href="../articles/skeleton2-clean.html">Cleaning and deriving variables (skeleton2_clean)</a></li>
    <li><a class="dropdown-item" href="../articles/skeleton3-analyze.html">Batching (skeleton3_analyze)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cookbooks</h6></li>
    <li><a class="dropdown-item" href="../articles/cookbook-survival-analysis.html">Survival analysis with time-varying covariates</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/papadopoulos-lab/swereg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add diagnosis data to skeleton</h1>
      <small class="dont-index">Source: <a href="https://github.com/papadopoulos-lab/swereg/blob/main/R/add_diagnoses_and_operations.R" class="external-link"><code>R/add_diagnoses_and_operations.R</code></a></small>
      <div class="d-none name"><code>add_diagnoses.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Searches for specific ICD diagnosis codes in Swedish hospital registry data
and adds corresponding boolean variables to the skeleton. Can search in main
diagnoses only or both main and secondary diagnoses.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_diagnoses</span><span class="op">(</span></span>
<span>  <span class="va">skeleton</span>,</span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">id_name</span>,</span>
<span>  diag_type <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  diags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>icd10_F64_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F640"</span><span class="op">)</span>, icd10_F64_89 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F6489"</span><span class="op">)</span>, icd10_F64_089 <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F640"</span>, <span class="st">"F648"</span>, <span class="st">"F649"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-skeleton">skeleton<a class="anchor" aria-label="anchor" href="#arg-skeleton"></a></dt>
<dd><p>A data.table containing the main skeleton structure created by <code><a href="create_skeleton.html">create_skeleton</a></code></p></dd>


<dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>A data.table containing hospital registry data with diagnosis codes.
Must have columns for person ID, admission date (<code>indatum</code>), and at least one
diagnosis code column. Expected diagnosis columns after <code><a href="make_lowercase_names.html">make_lowercase_names()</a></code>:
<code>hdia</code> (main), <code>dia1</code>/<code>dia2</code>/etc (secondary), <code>ekod1</code>/<code>ekod2</code>/etc
(external causes), <code>icd7*</code>, <code>icd9*</code></p></dd>


<dt id="arg-id-name">id_name<a class="anchor" aria-label="anchor" href="#arg-id-name"></a></dt>
<dd><p>Character string specifying the name of the ID variable in the dataset</p></dd>


<dt id="arg-diag-type">diag_type<a class="anchor" aria-label="anchor" href="#arg-diag-type"></a></dt>
<dd><p>Character string specifying which diagnosis types to search:</p><ul><li><p>"both" (default) - Search in main (<code>hdia</code>), secondary (<code>dia*</code>),
    external cause (<code>ekod*</code>), and historical ICD version columns (<code>icd7*</code>, <code>icd9*</code>)</p></li>
<li><p>"main" - Search only in main diagnosis column (<code>hdia</code>)</p></li>
</ul></dd>


<dt id="arg-diags">diags<a class="anchor" aria-label="anchor" href="#arg-diags"></a></dt>
<dd><p>Named list of ICD code patterns to search for. Names become variable names in skeleton.
Patterns should NOT include "^" prefix (automatically added). Use exclusions with "!" prefix.
Example: <code>list("depression" = c("F32", "F33"), "anxiety" = c("F40", "F41"))</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The skeleton data.table is modified by reference with diagnosis variables added.
  New boolean variables are created for each diagnosis pattern, TRUE when diagnosis is present.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function searches across different diagnosis code column types based on the
<code>diag_type</code> parameter:</p><ul><li><p>When <code>diag_type = "both"</code>: Searches in <code>hdia</code> (main diagnosis),
    <code>dia1, dia2, ...</code> (secondary diagnoses), <code>ekod1, ekod2, ...</code>
    (external cause codes), <code>icd7*</code> (ICD-7 codes), and <code>icd9*</code> (ICD-9 codes)</p></li>
<li><p>When <code>diag_type = "main"</code>: Searches only in <code>hdia</code> (main diagnosis)</p></li>
</ul><p>## Filtering by source (inpatient/outpatient/cancer)</p>
<p>The diagnosis dataset must contain a <code>source</code> column with valid values
("inpatient", "outpatient", or "cancer"). To track diagnoses separately by source,
filter the dataset before calling this function:</p>
<div class="sourceCode"><pre><code><span></span>
<span><span class="co"># Inpatient diagnoses only</span></span>
<span><span class="va">inpatient_data</span> <span class="op">&lt;-</span> <span class="va">diagnoses</span><span class="op">[</span><span class="va">source</span> <span class="op">==</span> <span class="st">"inpatient"</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/add_diagnoses.html">add_diagnoses</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">inpatient_data</span>, <span class="st">"lopnr"</span>, diags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"depression_inpatient"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F32"</span>, <span class="st">"F33"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Outpatient diagnoses only</span></span>
<span><span class="va">outpatient_data</span> <span class="op">&lt;-</span> <span class="va">diagnoses</span><span class="op">[</span><span class="va">source</span> <span class="op">==</span> <span class="st">"outpatient"</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/add_diagnoses.html">add_diagnoses</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">outpatient_data</span>, <span class="st">"lopnr"</span>, diags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"depression_outpatient"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F32"</span>, <span class="st">"F33"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combined (any source) - default behavior</span></span>
<span><span class="fu"><a href="../reference/add_diagnoses.html">add_diagnoses</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">diagnoses</span>, <span class="st">"lopnr"</span>, diags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"depression_any"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F32"</span>, <span class="st">"F33"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="create_skeleton.html">create_skeleton</a></code> for creating the skeleton structure,
  <code><a href="add_operations.html">add_operations</a></code> for surgical procedures,
  <code><a href="add_rx.html">add_rx</a></code> for prescription data,
  <code><a href="make_lowercase_names.html">make_lowercase_names</a></code> for data preprocessing</p>
<p>Other data_integration:
<code><a href="add_annual.html">add_annual()</a></code>,
<code><a href="add_cods.html">add_cods()</a></code>,
<code><a href="add_icdo3s.html">add_icdo3s()</a></code>,
<code><a href="add_onetime.html">add_onetime()</a></code>,
<code><a href="add_operations.html">add_operations()</a></code>,
<code><a href="add_rx.html">add_rx()</a></code>,
<code><a href="add_snomed3s.html">add_snomed3s()</a></code>,
<code><a href="add_snomedo10s.html">add_snomedo10s()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load fake data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fake_person_ids"</span>, package <span class="op">=</span> <span class="st">"swereg"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fake_diagnoses"</span>, package <span class="op">=</span> <span class="st">"swereg"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="make_lowercase_names.html">make_lowercase_names</a></span><span class="op">(</span><span class="va">fake_diagnoses</span>, date_columns <span class="op">=</span> <span class="st">"indatum"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Found additional date columns not in date_columns: utdatum. Consider adding them for automatic date parsing.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create skeleton</span></span></span>
<span class="r-in"><span><span class="va">skeleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="create_skeleton.html">create_skeleton</a></span><span class="op">(</span><span class="va">fake_person_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="st">"2020-01-01"</span>, <span class="st">"2020-12-31"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add diagnoses</span></span></span>
<span class="r-in"><span><span class="va">diag_patterns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"depression"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F32"</span>, <span class="st">"F33"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"anxiety"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F40"</span>, <span class="st">"F41"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">add_diagnoses</span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">fake_diagnoses</span>, <span class="st">"lopnr"</span>, <span class="st">"both"</span>, <span class="va">diag_patterns</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Crafted by <a href="https://www.rwhite.no" class="external-link">Richard Aubrey White</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

