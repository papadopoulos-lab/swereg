<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate inverse probability of censoring weights (IPCW-PP) — tte_calculate_ipcw • swereg</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate inverse probability of censoring weights (IPCW-PP) — tte_calculate_ipcw"><meta name="description" content="Calculates time-varying stabilized inverse probability of censoring weights
for per-protocol analysis in target trial emulation. IPCW-PP adjusts for
informative censoring due to protocol deviation or loss to follow-up."><meta property="og:description" content="Calculates time-varying stabilized inverse probability of censoring weights
for per-protocol analysis in target trial emulation. IPCW-PP adjusts for
informative censoring due to protocol deviation or loss to follow-up."><meta property="og:image" content="https://papadopoulos-lab.github.io/swereg/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">swereg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">26.2.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/skeleton-concept.html">Skeleton concept</a></li>
    <li><a class="dropdown-item" href="../articles/rowdep-rowind-concept.html">Variable types: rowdep vs rowind</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Implementation</h6></li>
    <li><a class="dropdown-item" href="../articles/skeleton1-create.html">Building the data skeleton (skeleton1_create)</a></li>
    <li><a class="dropdown-item" href="../articles/skeleton2-clean.html">Cleaning and deriving variables (skeleton2_clean)</a></li>
    <li><a class="dropdown-item" href="../articles/skeleton3-analyze.html">Batching (skeleton3_analyze)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cookbooks</h6></li>
    <li><a class="dropdown-item" href="../articles/cookbook-survival-analysis.html">Survival analysis with time-varying covariates</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/papadopoulos-lab/swereg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculate inverse probability of censoring weights (IPCW-PP)</h1>
      <small class="dont-index">Source: <a href="https://github.com/papadopoulos-lab/swereg/blob/main/R/tte_weights.R" class="external-link"><code>R/tte_weights.R</code></a></small>
      <div class="d-none name"><code>tte_calculate_ipcw.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates time-varying stabilized inverse probability of censoring weights
for per-protocol analysis in target trial emulation. IPCW-PP adjusts for
informative censoring due to protocol deviation or loss to follow-up.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tte_calculate_ipcw</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">exposure_var</span>,</span>
<span>  <span class="va">censoring_var</span>,</span>
<span>  <span class="va">confounder_vars</span>,</span>
<span>  id_var <span class="op">=</span> <span class="st">"trial_id"</span>,</span>
<span>  tstart_var <span class="op">=</span> <span class="st">"tstart"</span>,</span>
<span>  tstop_var <span class="op">=</span> <span class="st">"tstop"</span>,</span>
<span>  separate_by_exposure <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_gam <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data.table in counting-process format (one row per person per
time period). Should contain a censoring indicator column.</p></dd>


<dt id="arg-exposure-var">exposure_var<a class="anchor" aria-label="anchor" href="#arg-exposure-var"></a></dt>
<dd><p>Character, name of the baseline exposure column.</p></dd>


<dt id="arg-censoring-var">censoring_var<a class="anchor" aria-label="anchor" href="#arg-censoring-var"></a></dt>
<dd><p>Character, name of the binary censoring indicator
column (1 = censored at end of this period, 0 = not censored).</p></dd>


<dt id="arg-confounder-vars">confounder_vars<a class="anchor" aria-label="anchor" href="#arg-confounder-vars"></a></dt>
<dd><p>Character vector of confounder variable names for
the censoring model.</p></dd>


<dt id="arg-id-var">id_var<a class="anchor" aria-label="anchor" href="#arg-id-var"></a></dt>
<dd><p>Character, name of the trial identifier column
(default: "trial_id").</p></dd>


<dt id="arg-tstart-var">tstart_var<a class="anchor" aria-label="anchor" href="#arg-tstart-var"></a></dt>
<dd><p>Character, name of the period start time column
(default: "tstart").</p></dd>


<dt id="arg-tstop-var">tstop_var<a class="anchor" aria-label="anchor" href="#arg-tstop-var"></a></dt>
<dd><p>Character, name of the period end time column
(default: "tstop").</p></dd>


<dt id="arg-separate-by-exposure">separate_by_exposure<a class="anchor" aria-label="anchor" href="#arg-separate-by-exposure"></a></dt>
<dd><p>Logical, whether to fit separate censoring
models for each exposure stratum (default: TRUE). Recommended because
censoring hazards often differ by treatment.</p></dd>


<dt id="arg-use-gam">use_gam<a class="anchor" aria-label="anchor" href="#arg-use-gam"></a></dt>
<dd><p>Logical, whether to use GAM with smooth time term instead
of plain GLM (default: TRUE). GAM allows flexible, non-parametric time
trends in the censoring hazard.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The input data.table with added columns:</p><dl><dt>p_censor</dt>
<dd><p>Predicted probability of censoring this period</p></dd>

    <dt>p_uncensored</dt>
<dd><p>1 - p_censor</p></dd>

    <dt>cum_p_uncensored</dt>
<dd><p>Cumulative product of p_uncensored over time</p></dd>

    <dt>marginal_p</dt>
<dd><p>Marginal probability of remaining uncensored at each
      time point (within exposure stratum if `separate_by_exposure = TRUE`)</p></dd>

    <dt>cum_marginal</dt>
<dd><p>Cumulative product of marginal_p over time</p></dd>

    <dt>ipcw_pp</dt>
<dd><p>Stabilized IPCW-PP for per-protocol analysis = cum_marginal / cum_p_uncensored</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>IPCW-PP addresses informative censoring in per-protocol analysis. When people
deviate from assigned treatment or are lost to follow-up, this censoring
may be related to prognosis (sicker people may be more likely to change
treatment or die). IPCW-PP upweights people who were likely to be censored
but weren't, creating a pseudo-population where censoring is independent
of measured confounders.</p>
<p>**Algorithm:**</p><ol><li><p>Fit a model for P(censored | confounders, time)</p></li>
<li><p>Calculate conditional probability of remaining: p_uncensored = 1 - p_censor</p></li>
<li><p>Cumulative conditional: cum_p_uncensored = cumulative product over time</p></li>
<li><p>Marginal probability: average p_uncensored at each time (within exposure)</p></li>
<li><p>Cumulative marginal: cumulative product of marginal probabilities</p></li>
<li><p>Stabilized IPCW-PP = cum_marginal / cum_p_uncensored</p></li>
</ol><p>Separate models by exposure are recommended because the hazard of censoring
often differs by treatment (e.g., treated patients may discontinue due to
side effects while untreated may start treatment if symptoms worsen).</p>
<p>GAM with smooth time term is recommended because the censoring hazard may
vary non-linearly over time.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="tte_calculate_ipw.html">tte_calculate_ipw</a></code>, <code><a href="tte_identify_censoring.html">tte_identify_censoring</a></code>,
  <code><a href="tte_combine_weights.html">tte_combine_weights</a></code></p>
<p>Other tte_weights:
<code><a href="tte_calculate_ipw.html">tte_calculate_ipw()</a></code>,
<code><a href="tte_combine_weights.html">tte_combine_weights()</a></code>,
<code><a href="tte_identify_censoring.html">tte_identify_censoring()</a></code>,
<code><a href="tte_truncate_weights.html">tte_truncate_weights()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Assuming data is prepared with censoring indicators</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">tte_calculate_ipcw</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">counting_process_data</span>,</span></span>
<span class="r-in"><span>  exposure_var <span class="op">=</span> <span class="st">"baseline_exposed"</span>,</span></span>
<span class="r-in"><span>  censoring_var <span class="op">=</span> <span class="st">"censor_this_period"</span>,</span></span>
<span class="r-in"><span>  confounder_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_cat"</span>, <span class="st">"education"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  use_gam <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Crafted by <a href="https://www.rwhite.no" class="external-link">Richard Aubrey White</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

