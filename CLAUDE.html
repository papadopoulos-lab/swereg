<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • swereg</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"><meta property="og:image" content="https://papadopoulos-lab.github.io/swereg/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">swereg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">26.2.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/skeleton-concept.html">Skeleton concept</a></li>
    <li><a class="dropdown-item" href="articles/rowdep-rowind-concept.html">Variable types: rowdep vs rowind</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Implementation</h6></li>
    <li><a class="dropdown-item" href="articles/skeleton1-create.html">Building the data skeleton (skeleton1_create)</a></li>
    <li><a class="dropdown-item" href="articles/skeleton2-clean.html">Cleaning and deriving variables (skeleton2_clean)</a></li>
    <li><a class="dropdown-item" href="articles/skeleton3-analyze.html">Batching (skeleton3_analyze)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cookbooks</h6></li>
    <li><a class="dropdown-item" href="articles/cookbook-survival-analysis.html">Survival analysis with time-varying covariates</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/papadopoulos-lab/swereg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/papadopoulos-lab/swereg/blob/main/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="project-overview">Project overview<a class="anchor" aria-label="anchor" href="#project-overview"></a></h2>
<p><strong>swereg</strong> is an R package for manipulating and analyzing Swedish healthcare registry data in epidemiological research. It creates longitudinal data skeletons with ISO year-week structure and integrates multiple Swedish health registries (NPR, LMED, Cause of Death). The package is optimized for gender dysphoria research but works for general registry analysis.</p>
</div>
<div class="section level2">
<h2 id="development-commands">Development commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="core-development-workflow">Core development workflow<a class="anchor" aria-label="anchor" href="#core-development-workflow"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Load package functions during development</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"."</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Generate documentation</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># Check package integrity (includes tests, examples, documentation)</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Alternative: Use R CMD check (more comprehensive, CRAN-style)</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>R CMD check .</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># Build and install</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>()</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install</span>()</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing-and-development-scripts">Testing and development scripts<a class="anchor" aria-label="anchor" href="#testing-and-development-scripts"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate fake data (run once or when data structure changes)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"dev/generate_fake_data.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quick functionality test</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"dev/quick_test.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Full workflow test with all features</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"dev/test_with_fake_data.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Memory-efficient batched workflow (production-style)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"dev/workflow_batched_memory_efficient.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load required libraries for manual testing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="architecture-and-data-flow">Architecture and data flow<a class="anchor" aria-label="anchor" href="#architecture-and-data-flow"></a></h2>
<div class="section level3">
<h3 id="three-stage-workflow-pattern">Three-stage workflow pattern<a class="anchor" aria-label="anchor" href="#three-stage-workflow-pattern"></a></h3>
<p>swereg follows a systematic three-stage approach (“Good Bones, Then Muscles”):</p>
<ol style="list-style-type: decimal"><li>
<strong>skeleton1_create</strong>: Raw data integration - Create time skeleton and merge registry data</li>
<li>
<strong>skeleton2_clean</strong>: Data cleaning and derived variables - Clean and process within skeleton</li>
<li>
<strong>skeleton3_analyze</strong>: Analysis-ready dataset preparation - Final analysis preparation</li>
</ol></div>
<div class="section level3">
<h3 id="core-pattern-longitudinal-skeleton--sequential-data-integration">Core pattern: longitudinal skeleton + sequential data integration<a class="anchor" aria-label="anchor" href="#core-pattern-longitudinal-skeleton--sequential-data-integration"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Skeleton Creation</strong>: <code><a href="reference/create_skeleton.html">create_skeleton()</a></code> builds time-structured framework with individual IDs and ISO weeks</li>
<li>
<strong>Sequential Data Addition</strong>: Use specialized functions to add different data types</li>
<li>
<strong>data.table Optimization</strong>: All operations use data.table for efficient processing of large datasets</li>
</ol></div>
<div class="section level3">
<h3 id="key-integration-functions-in-typical-order-of-use">Key integration functions (in typical order of use)<a class="anchor" aria-label="anchor" href="#key-integration-functions-in-typical-order-of-use"></a></h3>
<ul><li>
<code><a href="reference/add_onetime.html">add_onetime()</a></code> - Baseline/demographic data (one record per person)</li>
<li>
<code><a href="reference/add_annual.html">add_annual()</a></code> - Annual data for specific years (e.g., socioeconomic status)</li>
<li>
<code><a href="reference/add_diagnoses.html">add_diagnoses()</a></code> - NPR diagnosis data with ICD-10 codes (hospital visits)</li>
<li>
<code><a href="reference/add_operations.html">add_operations()</a></code> - Surgical procedure codes from NPR</li>
<li>
<code><a href="reference/add_rx.html">add_rx()</a></code> - LMED prescription data with ATC codes and treatment periods</li>
<li>
<code><a href="reference/add_cods.html">add_cods()</a></code> - Cause of death information</li>
</ul></div>
<div class="section level3">
<h3 id="swedish-registry-context">Swedish registry context<a class="anchor" aria-label="anchor" href="#swedish-registry-context"></a></h3>
<ul><li>
<strong>NPR</strong> (National Patient Register): Specialist healthcare (inpatient <code>sv</code> and outpatient <code>ov</code>)</li>
<li>
<strong>LMED</strong> (Prescribed Drug Register): Prescription medications with ATC codes</li>
<li>
<strong>SCB</strong> (Statistics Sweden): Demographics and socioeconomic data</li>
<li>
<strong>Cause of Death Register</strong>: Mortality data with ICD-10 codes</li>
<li>Uses <code>cstime</code> package for Swedish ISO time standards</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="critical-data-processing-rules">Critical data processing rules<a class="anchor" aria-label="anchor" href="#critical-data-processing-rules"></a></h2>
<div class="section level3">
<h3 id="always-apply-make_lowercase_names-with-date-cleaning">Always apply make_lowercase_names() with date cleaning<a class="anchor" aria-label="anchor" href="#always-apply-make_lowercase_names-with-date-cleaning"></a></h3>
<p><strong>ESSENTIAL</strong>: All imported data must be processed with <code><a href="reference/make_lowercase_names.html">swereg::make_lowercase_names()</a></code> before use. Now includes automatic date cleaning:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"file.txt"</span><span class="op">)</span>  <span class="co"># or haven::read_sas() etc.</span></span>
<span></span>
<span><span class="co"># REQUIRED: Apply lowercase transformation with date cleaning</span></span>
<span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="reference/make_lowercase_names.html">make_lowercase_names</a></span><span class="op">(</span><span class="va">data</span>, date_column <span class="op">=</span> <span class="st">"INDATUM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now safe to use with swereg functions - note that a 'date' column is created</span></span>
<span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="reference/add_diagnoses.html">add_diagnoses</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">data</span>, id_name <span class="op">=</span> <span class="st">"lopnr"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>This transforms column names like <code>LopNr</code> → <code>lopnr</code>, <code>ATC</code> → <code>atc</code>, <code>INDATUM</code> → <code>indatum</code>, and converts specified date columns to Date class.</p>
</div>
<div class="section level3">
<h3 id="swedish-date-parsing">Swedish date parsing<a class="anchor" aria-label="anchor" href="#swedish-date-parsing"></a></h3>
<p>Swedish registry dates come in different precision levels. The <code><a href="reference/make_lowercase_names.html">make_lowercase_names()</a></code> function with <code>date_columns</code> parameter handles:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply make_lowercase_names with date parsing</span></span>
<span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="reference/make_lowercase_names.html">make_lowercase_names</a></span><span class="op">(</span><span class="va">data</span>, date_columns <span class="op">=</span> <span class="st">"INDATUM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Custom defaults for missing date parts</span></span>
<span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="reference/make_lowercase_names.html">make_lowercase_names</a></span><span class="op">(</span><span class="va">data</span>, date_columns <span class="op">=</span> <span class="st">"INDATUM"</span>, </span>
<span>                            default_month_day <span class="op">=</span> <span class="st">"0101"</span>, default_day <span class="op">=</span> <span class="st">"01"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Date format handling:</strong> - <strong>4 characters (YYYY)</strong>: Year only → adds July 1st by default - <strong>6 characters (YYYYMM)</strong>: Year-month → adds 15th by default<br>
- <strong>8 characters (YYYYMMDD)</strong>: Full date → uses as-is - <strong>Special cases</strong>: “0000” → “0701”, “00” → “15”</p>
</div>
<div class="section level3">
<h3 id="expected-column-names-after-make_lowercase_names">Expected column names after make_lowercase_names()<a class="anchor" aria-label="anchor" href="#expected-column-names-after-make_lowercase_names"></a></h3>
<ul><li>
<strong>Person IDs</strong>: <code>lopnr</code> (SCB), <code>lopnr</code> (NPR after transformation), <code>p444_lopnr_personnr</code> (LMED)</li>
<li>
<strong>Dates</strong>: <code>indatum</code> (admission), <code>utdatum</code> (discharge), <code>edatum</code> (prescription), <code>dodsdat</code> (death)</li>
<li>
<strong>Note</strong>: Date columns are converted to Date class in place when date_columns parameter is used</li>
<li>
<strong>Diagnosis codes</strong>: <code>hdia</code> (main), <code>dia1</code>, <code>dia2</code>, etc. (secondary), <code>ekod1</code>, etc. (external causes)</li>
<li>
<strong>Operation codes</strong>: <code>op1</code>, <code>op2</code>, etc.</li>
<li>
<strong>Prescription codes</strong>: <code>atc</code> (drug code), <code>fddd</code> (treatment duration)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="package-data-for-development">Package data for development<a class="anchor" aria-label="anchor" href="#package-data-for-development"></a></h2>
<p>The package includes synthetic Swedish registry data for development and examples: - <code>fake_demographics</code> - SCB demographics (<code>lopnr</code>, <code>fodelseman</code>, <code>DodDatum</code>) - <code>fake_annual_family</code> - SCB annual family data (<code>lopnr</code>, <code>FamTyp</code>) - <code>fake_diagnoses</code> - Combined diagnoses with SOURCE column (inpatient/outpatient/cancer) - <code>fake_prescriptions</code> - LMED prescription data (37 columns) - <code>fake_cod</code> - Cause of death registry data - <code>fake_person_ids</code> - Reference list of person identifiers</p>
<p>Load with: <code>data("fake_demographics")</code> etc.</p>
<p><strong>Note</strong>: These are synthetic datasets designed to replicate the structure and characteristics of real Swedish registry data while maintaining confidentiality and privacy.</p>
</div>
<div class="section level2">
<h2 id="code-patterns">Code patterns<a class="anchor" aria-label="anchor" href="#code-patterns"></a></h2>
<div class="section level3">
<h3 id="typical-analysis-workflow">Typical analysis workflow<a class="anchor" aria-label="anchor" href="#typical-analysis-workflow"></a></h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Create skeleton (now includes personyears column)</span></span>
<span><span class="va">skeleton</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_skeleton.html">create_skeleton</a></span><span class="op">(</span><span class="va">ids</span>, <span class="st">"2001-01-01"</span>, <span class="st">"2020-12-31"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Add baseline data</span></span>
<span><span class="va">demographics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"demographics.csv"</span><span class="op">)</span></span>
<span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="reference/make_lowercase_names.html">make_lowercase_names</a></span><span class="op">(</span><span class="va">demographics</span>, date_columns <span class="op">=</span> <span class="st">"FodelseMan"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/add_onetime.html">add_onetime</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">demographics</span>, <span class="st">"lopnr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Add longitudinal data</span></span>
<span><span class="va">hospital_data</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu">read_sas</span><span class="op">(</span><span class="st">"hospital.sas7bdat"</span><span class="op">)</span></span>
<span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="reference/make_lowercase_names.html">make_lowercase_names</a></span><span class="op">(</span><span class="va">hospital_data</span>, date_columns <span class="op">=</span> <span class="st">"INDATUM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/add_diagnoses.html">add_diagnoses</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">hospital_data</span>, <span class="st">"lopnr"</span>, diags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"depression"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"^F32"</span>, <span class="st">"^F33"</span><span class="op">)</span>,</span>
<span>  <span class="st">"anxiety"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"^F40"</span>, <span class="st">"^F41"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3b. Optional: Track diagnoses by source (inpatient/outpatient) separately</span></span>
<span><span class="co"># Filter the dataset before calling add_diagnoses() for source-specific tracking</span></span>
<span><span class="va">inpatient_data</span> <span class="op">&lt;-</span> <span class="va">hospital_data</span><span class="op">[</span><span class="va">source</span> <span class="op">==</span> <span class="st">"inpatient"</span><span class="op">]</span></span>
<span><span class="fu"><a href="reference/add_diagnoses.html">add_diagnoses</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">inpatient_data</span>, <span class="st">"lopnr"</span>, diags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"depression_inpatient"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"^F32"</span>, <span class="st">"^F33"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">outpatient_data</span> <span class="op">&lt;-</span> <span class="va">hospital_data</span><span class="op">[</span><span class="va">source</span> <span class="op">==</span> <span class="st">"outpatient"</span><span class="op">]</span></span>
<span><span class="fu"><a href="reference/add_diagnoses.html">add_diagnoses</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">outpatient_data</span>, <span class="st">"lopnr"</span>, diags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"depression_outpatient"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"^F32"</span>, <span class="st">"^F33"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Add prescriptions</span></span>
<span><span class="va">prescriptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"prescriptions.txt"</span><span class="op">)</span></span>
<span><span class="fu">swereg</span><span class="fu">::</span><span class="fu"><a href="reference/make_lowercase_names.html">make_lowercase_names</a></span><span class="op">(</span><span class="va">prescriptions</span>, date_columns <span class="op">=</span> <span class="st">"EDATUM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/add_rx.html">add_rx</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="va">prescriptions</span>, <span class="st">"lopnr"</span>, drugs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"antidepressants"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"^N06A"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Create rowind variables (skeleton2_clean phase)</span></span>
<span><span class="co"># Age at first depression diagnosis</span></span>
<span><span class="fu"><a href="reference/make_rowind_first_occurrence.html">make_rowind_first_occurrence</a></span><span class="op">(</span><span class="va">skeleton</span>,</span>
<span>                            condition <span class="op">=</span> <span class="st">"depression == TRUE"</span>,</span>
<span>                            value_var <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>                            new_var <span class="op">=</span> <span class="st">"rowind_age_first_depression"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Year of first antidepressant prescription  </span></span>
<span><span class="fu"><a href="reference/make_rowind_first_occurrence.html">make_rowind_first_occurrence</a></span><span class="op">(</span><span class="va">skeleton</span>,</span>
<span>                            condition <span class="op">=</span> <span class="st">"antidepressants == TRUE"</span>,</span>
<span>                            value_var <span class="op">=</span> <span class="st">"isoyear"</span>,</span>
<span>                            new_var <span class="op">=</span> <span class="st">"rowind_isoyear_first_antidep"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pattern-matching-for-medical-codes">Pattern matching for medical codes<a class="anchor" aria-label="anchor" href="#pattern-matching-for-medical-codes"></a></h3>
<ul><li>
<strong>Regex patterns</strong>: Use <code>^</code> prefix for exact starts (e.g., <code>"^F640"</code>)</li>
<li>
<strong>Exclusions</strong>: Use <code>!</code> prefix to exclude (e.g., <code>"!F640"</code>)</li>
<li>
<strong>Multiple patterns</strong>: Combine in lists (e.g., <code>c("^F640", "^F648", "^F649")</code>)</li>
<li>
<strong>Historical codes</strong>: ICD-9 uses <code>[A-Z]</code> suffixes, ICD-8 uses comma delimiters</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="data-variable-types-and-transformations">Data Variable Types and Transformations<a class="anchor" aria-label="anchor" href="#data-variable-types-and-transformations"></a></h2>
<div class="section level3">
<h3 id="understanding-rowdep-vs-rowind-variables">Understanding rowdep vs rowind Variables<a class="anchor" aria-label="anchor" href="#understanding-rowdep-vs-rowind-variables"></a></h3>
<p>In longitudinal registry data analysis with swereg, variables are classified into two fundamental types:</p>
<ul><li>
<strong>rowdep</strong> (row-dependent): Variables that can change over time for a person</li>
<li>
<strong>rowind</strong> (row-independent): Variables that cannot change over time for a person</li>
</ul><p>This distinction is crucial for effective analysis, particularly during the <code>skeleton2_clean</code> phase where many transformations convert <code>rowdep</code> variables into <code>rowind</code> variables.</p>
</div>
<div class="section level3">
<h3 id="examples-of-variable-types">Examples of Variable Types<a class="anchor" aria-label="anchor" href="#examples-of-variable-types"></a></h3>
<p><strong>Row-dependent (rowdep) Variables:</strong> - <code>rowdep_edu_cat</code>: Education level (can improve over time) - <code>rowdep_income_inflation_adjusted</code>: Annual income (changes yearly) - <code>f64_diag</code>: Had diagnosis this week (TRUE/FALSE by time period) - Current values that vary by isoyear/isoyearweek</p>
<p><strong>Row-independent (rowind) Variables:</strong> - <code>rowind_age_first_gd</code>: Age at first diagnosis (fixed once occurred) - <code>rowind_isoyear_first_gd</code>: Year of first diagnosis (historical fact) - <code>rowind_birthcountry</code>: Birth country (never changes) - <code>rowind_register_tag</code>: Person’s role in study (case, control, etc.) - <code>rowind_age_death</code>: Age at death (fixed once occurred)</p>
</div>
<div class="section level3">
<h3 id="helper-function-make_rowind_first_occurrence">Helper Function: make_rowind_first_occurrence()<a class="anchor" aria-label="anchor" href="#helper-function-make_rowind_first_occurrence"></a></h3>
<p>The <code><a href="reference/make_rowind_first_occurrence.html">make_rowind_first_occurrence()</a></code> function simplifies the common pattern of creating row-independent variables from the first occurrence of conditions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: Create rowind variable for year of first F64 diagnosis</span></span>
<span><span class="fu"><a href="reference/make_rowind_first_occurrence.html">make_rowind_first_occurrence</a></span><span class="op">(</span><span class="va">skeleton</span>,</span>
<span>                            condition <span class="op">=</span> <span class="st">"f64_diag == TRUE"</span>,</span>
<span>                            value_var <span class="op">=</span> <span class="st">"isoyear"</span>, </span>
<span>                            new_var <span class="op">=</span> <span class="st">"rowind_isoyear_first_f64"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># More complex condition example</span></span>
<span><span class="fu"><a href="reference/make_rowind_first_occurrence.html">make_rowind_first_occurrence</a></span><span class="op">(</span><span class="va">skeleton</span>,</span>
<span>                            condition <span class="op">=</span> <span class="st">"diag_gd_icd10_F64_089 == TRUE &amp; is_amab == FALSE"</span>,</span>
<span>                            value_var <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>                            new_var <span class="op">=</span> <span class="st">"rowind_age_first_gd_afab"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Function features:</strong> - Automatically handles temp variable creation and cleanup - Uses <code><a href="reference/first_non_na.html">first_non_na()</a></code> for robust aggregation across all variable types - Includes comprehensive input validation and clear error messages - Works with any condition that can be evaluated in data.table syntax</p>
</div>
<div class="section level3">
<h3 id="common-rowdep--rowind-transformation-patterns">Common rowdep → rowind Transformation Patterns<a class="anchor" aria-label="anchor" href="#common-rowdep--rowind-transformation-patterns"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Manual pattern (traditional approach)</span></span>
<span><span class="va">skeleton</span><span class="op">[</span><span class="va">condition_is_true</span>, <span class="va">temp</span> <span class="op">:=</span> <span class="va">value_to_capture</span><span class="op">]</span></span>
<span><span class="va">skeleton</span><span class="op">[</span>, <span class="va">new_rowind_var</span> <span class="op">:=</span> <span class="fu"><a href="reference/first_non_na.html">first_non_na</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">skeleton</span><span class="op">[</span>, <span class="va">temp</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Helper function pattern (recommended)</span></span>
<span><span class="fu"><a href="reference/make_rowind_first_occurrence.html">make_rowind_first_occurrence</a></span><span class="op">(</span><span class="va">skeleton</span>, <span class="st">"condition_is_true"</span>, <span class="st">"value_to_capture"</span>, <span class="st">"new_rowind_var"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="integration-with-swereg-workflow">Integration with swereg Workflow<a class="anchor" aria-label="anchor" href="#integration-with-swereg-workflow"></a></h3>
<p>The rowdep/rowind concept fits into the standard swereg workflow:</p>
<ol style="list-style-type: decimal"><li>
<strong>skeleton1_create</strong>: Focus on data integration, creates mostly rowdep variables</li>
<li>
<strong>skeleton2_clean</strong>: Heavy focus on rowdep → rowind transformations<br></li>
<li>
<strong>skeleton3_analyze</strong>: Work with clean rowind variables for analysis</li>
</ol><p>The <code>skeleton2_clean</code> phase is where most rowdep → rowind transformations occur, as you prepare stable person-level characteristics for downstream analysis.</p>
</div>
<div class="section level3">
<h3 id="naming-conventions">Naming Conventions<a class="anchor" aria-label="anchor" href="#naming-conventions"></a></h3>
<ul><li>Use <code>rowdep_*</code> prefix for time-varying variables</li>
<li>Use <code>rowind_*</code> prefix for time-invariant variables</li>
<li>Be descriptive: <code>rowind_age_first_gd</code> not <code>rowind_age</code>
</li>
<li>Include context: <code>rowind_isoyear_first_diagnosis</code> not <code>rowind_year</code>
</li>
</ul></div>
<div class="section level3">
<h3 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a></h3>
<p><strong>Always validate rowind variables:</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check that rowind variables are actually row-independent</span></span>
<span><span class="va">skeleton</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>unique_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/duplicated.html" class="external-link">uniqueN</a></span><span class="op">(</span><span class="va">rowind_age_first_f64</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Should return 1 for all persons (all rows have same value)</span></span></code></pre></div>
<p><strong>For detailed examples and patterns</strong>, see the “Understanding rowdep and rowind Variables” vignette:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"rowdep-rowind-concept"</span>, package <span class="op">=</span> <span class="st">"swereg"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="production-workflow-pattern">Production workflow pattern<a class="anchor" aria-label="anchor" href="#production-workflow-pattern"></a></h2>
<div class="section level3">
<h3 id="memory-efficient-batched-processing">Memory-efficient batched processing<a class="anchor" aria-label="anchor" href="#memory-efficient-batched-processing"></a></h3>
<p>For large datasets, use the 3-phase batched approach with helper functions in <code>example/R_generic_v002/</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Phase 1: Read large datasets once</span></span>
<span><span class="va">large_files</span> <span class="op">&lt;-</span> <span class="fu">read_large_files</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Phase 2: Create skeleton1_create (compilation to skeleton format)</span></span>
<span><span class="co"># Process in batches to manage memory</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">batch</span> <span class="kw">in</span> <span class="va">batches</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">skeleton1_create</span><span class="op">(</span><span class="va">batch</span>, <span class="va">ids_batch</span>, <span class="va">large_files</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">large_files</span><span class="op">)</span>  <span class="co"># Remove from RAM</span></span>
<span></span>
<span><span class="co"># Phase 3: Create skeleton2_clean (clean variables using only skeleton data)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">batch</span> <span class="kw">in</span> <span class="va">batches</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">skeleton2_clean</span><span class="op">(</span><span class="va">batch</span><span class="op">)</span>  <span class="co"># Use only data within skeleton</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="production-example-scripts">Production example scripts<a class="anchor" aria-label="anchor" href="#production-example-scripts"></a></h3>
<p>The <code>example/</code> directory contains production-style workflow implementations: - <code>example/R_generic_v002/</code> - Helper functions for batched processing - <code>example/Run_generic_v002.R</code> - Main production workflow script - Individual project scripts showing real-world usage patterns</p>
<p><strong>Key principles:</strong> - <strong>Batch processing</strong>: Split individuals into groups (e.g., 50-100 per batch) - <strong>Memory management</strong>: Remove large datasets after skeleton1_create phase - <strong>Self-contained cleaning</strong>: skeleton2_clean uses only data within skeleton</p>
</div>
</div>
<div class="section level2">
<h2 id="key-dependencies">Key dependencies<a class="anchor" aria-label="anchor" href="#key-dependencies"></a></h2>
<p><strong>Core</strong>: data.table, cstime, fs, stringr, dplyr, lubridate, haven<br><strong>Development</strong>: devtools, usethis, testthat, ggplot2 <strong>Note</strong>: Package now uses base pipe <code>|&gt;</code> instead of magrittr <code>%&gt;%</code> (requires R ≥ 4.1)</p>
</div>
<div class="section level2">
<h2 id="version-control-and-release-management">Version control and release management<a class="anchor" aria-label="anchor" href="#version-control-and-release-management"></a></h2>
<div class="section level3">
<h3 id="required-version-updates">REQUIRED: version updates<a class="anchor" aria-label="anchor" href="#required-version-updates"></a></h3>
<p>Whenever code is updated, <strong>BOTH</strong> of the following must be done:</p>
<p><strong>A) Update version in DESCRIPTION to YY.M.D format (remove leading zeroes):</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Example: For January 5, 2025</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>Version<span class="sc">:</span> <span class="dv">25</span>.<span class="fl">1.5</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co"># Example: For December 25, 2024  </span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>Version<span class="sc">:</span> <span class="dv">24</span>.<span class="fl">12.25</span></span></code></pre></div>
<p><strong>B) Update NEWS.md with changes:</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu"># swereg YY.M.D</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">## Bug Fixes</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="ss">* </span>Fixed issue with...</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="fu">## New Features  </span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="ss">* </span>Added function for...</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="fu">## Documentation</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="ss">* </span>Updated vignette for...</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="version-format-rules">Version format rules<a class="anchor" aria-label="anchor" href="#version-format-rules"></a></h3>
<ul><li>Use <code>YY.M.D</code> format (e.g., <code>25.1.5</code> not <code>25.01.05</code>)</li>
<li>Remove all leading zeroes from month and day</li>
<li>Update both DESCRIPTION and NEWS.md simultaneously</li>
<li>Document all user-facing changes in NEWS.md</li>
</ul></div>
<div class="section level3">
<h3 id="git-configuration-requirements">Git configuration requirements<a class="anchor" aria-label="anchor" href="#git-configuration-requirements"></a></h3>
<p>Before working with this repository, ensure git is properly configured:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># Required identity configuration</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.email <span class="st">"hello@rwhite.no"</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.name <span class="st">"Richard Aubrey White"</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># Required signing configuration for security</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> commit.gpgsign true</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> gpg.format ssh</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> user.signingkey ~/.ssh/id_ed25519.pub</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co"># Required merge behavior</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="fu">git</span> config <span class="at">--global</span> pull.rebase false</span></code></pre></div>
<p><strong>Note</strong>: Adjust the SSH key path if working in a different environment. The signing key should point to the public SSH key file.</p>
</div>
<div class="section level3">
<h3 id="git-commit-message-format">Git commit message format<a class="anchor" aria-label="anchor" href="#git-commit-message-format"></a></h3>
<p><strong>REQUIRED</strong>: All commit messages must follow this format (NO Claude/AI attribution):</p>
<pre><code>Brief description of changes

- Bullet point of change 1
- Bullet point of change 2
- Bullet point of change 3</code></pre>
<p><strong>NEVER include</strong>: - Claude/AI attribution - “Generated with Claude Code” - “Co-Authored-By: Claude” - Any mention of AI assistance</p>
<p><strong>Guidelines</strong>: - Use standard commit message format: “Add feature X”, “Fix bug in Y”, “Update documentation” - Focus on what was changed, not who/what made the change - Example: “Add fake Swedish registry datasets” (not “Claude added fake datasets”) - All commits must be signed (configured above)</p>
</div>
</div>
<div class="section level2">
<h2 id="github-actions-and-documentation">GitHub actions and documentation<a class="anchor" aria-label="anchor" href="#github-actions-and-documentation"></a></h2>
<div class="section level3">
<h3 id="automated-pkgdown-documentation">Automated pkgdown documentation<a class="anchor" aria-label="anchor" href="#automated-pkgdown-documentation"></a></h3>
<p>The repository includes GitHub Actions that automatically: - Build pkgdown documentation on every push to main/master - Deploy to GitHub Pages at: <code>https://papadopoulos-lab.github.io/swereg/</code> - Include all vignettes, function documentation, and news updates</p>
</div>
<div class="section level3">
<h3 id="setup-requirements-one-time">Setup requirements (one-time)<a class="anchor" aria-label="anchor" href="#setup-requirements-one-time"></a></h3>
<ol style="list-style-type: decimal"><li>
<strong>Enable GitHub Pages</strong>: Go to Settings &gt; Pages &gt; Source: “GitHub Actions”</li>
<li>
<strong>Permissions</strong>: Ensure Actions have write permissions (Settings &gt; Actions &gt; General)</li>
<li>
<strong>Branch Protection</strong>: Configure main/master branch as default</li>
</ol></div>
<div class="section level3">
<h3 id="local-pkgdown-development">Local pkgdown development<a class="anchor" aria-label="anchor" href="#local-pkgdown-development"></a></h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install pkgdown if not already installed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pkgdown"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build site locally to preview</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open in browser</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/preview_site.html" class="external-link">preview_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The site automatically includes: - Function reference with examples - Vignettes as “Articles” - News/changelog from NEWS.md - Automatic linking between functions</p>
</div>
</div>
<div class="section level2">
<h2 id="vignettes-structure">Vignettes structure<a class="anchor" aria-label="anchor" href="#vignettes-structure"></a></h2>
<p>The package includes three vignettes following a progressive learning structure:</p>
<ul><li>
<strong>Basic workflow</strong>: <code>vignette("basic-workflow")</code> - Introduction to skeleton1_create stage</li>
<li>
<strong>Complete workflow</strong>: <code>vignette("complete-workflow")</code> - Two-stage pipeline (skeleton1_create + skeleton2_clean)</li>
<li>
<strong>Memory-efficient batching</strong>: <code>vignette("memory-efficient-batching")</code> - Complete three-stage pipeline with production-scale batching</li>
</ul><div class="section level3">
<h3 id="vignette-organization">Vignette organization<a class="anchor" aria-label="anchor" href="#vignette-organization"></a></h3>
<ul><li>
<strong>Getting Started</strong>: basic-workflow (focuses on skeleton1_create only)</li>
<li>
<strong>Advanced Usage</strong>: complete-workflow and memory-efficient-batching (full workflows)</li>
<li>
<strong>Clear progression</strong>: Each vignette builds on the previous without overlap</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="function-documentation-improvements">Function documentation improvements<a class="anchor" aria-label="anchor" href="#function-documentation-improvements"></a></h2>
<p>All exported functions now include: - <strong>@family tags</strong>: Functions grouped by purpose (data_integration, skeleton_creation, data_preprocessing) - <strong>@seealso sections</strong>: Cross-references to related functions and vignettes - <strong>Runnable examples</strong>: All examples use synthetic data included in the package - <strong>Comprehensive parameter documentation</strong>: Clear descriptions of expected inputs and outputs - <strong>Academic tone</strong>: Professional, objective language appropriate for scientific software - <strong>Better return value descriptions</strong>: Explicit documentation of side effects and modifications</p>
</div>
<div class="section level2">
<h2 id="cran-submission-preparation">CRAN submission preparation<a class="anchor" aria-label="anchor" href="#cran-submission-preparation"></a></h2>
<div class="section level3">
<h3 id="critical-requirements-checklist">Critical requirements checklist<a class="anchor" aria-label="anchor" href="#critical-requirements-checklist"></a></h3>
<p>Before CRAN submission, always verify:</p>
<ol style="list-style-type: decimal"><li>
<strong>Remove non-portable files</strong>: Delete Synology-specific <code>@eaDir</code> directories</li>
<li>
<strong>URL consistency</strong>: Ensure DESCRIPTION and .onAttach use same GitHub organization URLs</li>
<li>
<strong>Test coverage</strong>: Add comprehensive tests with testthat (aim for &gt;80% coverage)</li>
<li>
<strong>Runnable examples</strong>: Convert all <code>\dontrun{}</code> to executable examples using fake data</li>
<li>
<strong>LICENSE year</strong>: Update to current year</li>
<li>
<strong>Clean inst/ directory</strong>: Only keep files referenced by package functions</li>
<li>
<strong>Dependencies</strong>: Use <code>@importFrom</code> or verify cstime:: usage is documented</li>
</ol></div>
<div class="section level3">
<h3 id="cran-check-workflow">CRAN check workflow<a class="anchor" aria-label="anchor" href="#cran-check-workflow"></a></h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Standard package check</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co"># REQUIRED: CRAN compliance check</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>R CMD check . <span class="sc">--</span>as<span class="sc">-</span>cran</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co"># Only run rhub when explicitly requested (requires manual review)</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co"># rhub::rhub_check()</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="package-organization-best-practices">Package organization best practices<a class="anchor" aria-label="anchor" href="#package-organization-best-practices"></a></h2>
<div class="section level3">
<h3 id="conceptual-function-separation">Conceptual function separation<a class="anchor" aria-label="anchor" href="#conceptual-function-separation"></a></h3>
<p>Organize functions by conceptual purpose, not just technical similarity:</p>
<ul><li>
<strong>Data transformation</strong> (<code>R/data_transformations.R</code>): Functions that change data meaning/structure (e.g., <code>make_rowind_first_occurrence</code>)</li>
<li>
<strong>Utility functions</strong> (<code>R/helper_functions.R</code>): Basic data processing helpers (e.g., <code>make_lowercase_names</code>, date parsing)</li>
<li>
<strong>Core functions</strong> (<code>R/skeleton_functions.R</code>): Main workflow functions</li>
</ul></div>
<div class="section level3">
<h3 id="dual-formatting-systems-approach">Dual formatting systems approach<a class="anchor" aria-label="anchor" href="#dual-formatting-systems-approach"></a></h3>
<p>When creating packages that may serve different audiences (local vs international), consider implementing dual formatting systems:</p>
<ul><li>
<strong>Separate by use case</strong>: Group functions by intended audience rather than technical similarity</li>
<li>
<strong>Consistent API patterns</strong>: Use parallel naming (<code>format_*_as_local</code> vs <code>format_*_as_international</code>)</li>
<li>
<strong>Internal helper functions</strong>: Create shared internal functions with <code>@noRd</code> to avoid namespace clutter</li>
<li>
<strong>Comprehensive testing</strong>: Include comparison tests that verify differences between formatting systems</li>
<li>
<strong>Clear documentation</strong>: Use vignettes to demonstrate differences with side-by-side examples</li>
</ul><p><strong>Example application to swereg</strong>: If implementing output formatting for Swedish research (domestic) vs international publication, separate functions would improve discoverability and prevent formatting errors in different contexts.</p>
</div>
<div class="section level3">
<h3 id="pkgdown-structure-principles">pkgdown structure principles<a class="anchor" aria-label="anchor" href="#pkgdown-structure-principles"></a></h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Group by conceptual purpose in _pkgdown.yml</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Data transformation</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="at">  </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> Functions for transforming data structure and creating derived variables</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> make_rowind_first_occurrence</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Utility functions  </span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="at">  </span><span class="fu">desc</span><span class="kw">:</span><span class="at"> Helper functions for data processing</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="kw">-</span><span class="at"> </span><span class="fu">contents</span><span class="kw">:</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> make_lowercase_names</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> parse_swedish_date</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="documentation-standards">Documentation standards<a class="anchor" aria-label="anchor" href="#documentation-standards"></a></h2>
<div class="section level3">
<h3 id="vignette-title-formatting">Vignette title formatting<a class="anchor" aria-label="anchor" href="#vignette-title-formatting"></a></h3>
<p>Use sentence case for all vignette titles and subtitles: - ✅ “Variable types: rowdep vs rowind” - ❌ “Variable Types: Rowdep vs Rowind” - ✅ “Understanding the concept” - ❌ “Understanding The Concept”</p>
</div>
<div class="section level3">
<h3 id="function-documentation-requirements">Function documentation requirements<a class="anchor" aria-label="anchor" href="#function-documentation-requirements"></a></h3>
<ul><li>Use <code>@family</code> tags for logical grouping</li>
<li>Include <code>@seealso</code> references to related functions</li>
<li>Provide runnable examples using package fake data</li>
<li>Document side effects explicitly for functions that modify by reference</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="common-issues-and-solutions">Common issues and solutions<a class="anchor" aria-label="anchor" href="#common-issues-and-solutions"></a></h2>
<ol style="list-style-type: decimal"><li>
<strong>Column name errors</strong>: Always use <code><a href="reference/make_lowercase_names.html">make_lowercase_names()</a></code> after reading data</li>
<li>
<strong>Missing cstime functions</strong>: Install cstime package for Swedish time standards</li>
<li>
<strong>Large dataset memory</strong>: Use data.table operations and avoid copying large datasets</li>
<li>
<strong>Date format issues</strong>: Ensure dates are in Date class, not character</li>
<li>
<strong>ID mismatches</strong>: Check that ID columns match between skeleton and data after name transformation</li>
<li>
<strong>CRAN submission failures</strong>: Review checklist above and run <code>R CMD check . --as-cran</code>
</li>
<li>
<strong>Vignette build errors</strong>: Ensure all referenced columns exist in fake data examples</li>
</ol></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Crafted by <a href="https://www.rwhite.no" class="external-link">Richard Aubrey White</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

