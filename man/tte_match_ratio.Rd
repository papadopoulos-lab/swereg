% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tte_weights.R
\name{tte_match_ratio}
\alias{tte_match_ratio}
\title{Match unexposed to exposed at a specified ratio}
\usage{
tte_match_ratio(
  data,
  exposure_var,
  eligible_var = NULL,
  ratio = 2,
  id_var = NULL,
  seed = NULL,
  mark_unsampled = "na"
)
}
\arguments{
\item{data}{A data.table containing the study population.}

\item{exposure_var}{Character, name of the binary exposure column.}

\item{eligible_var}{Character, name of the eligibility indicator column
(default: NULL, meaning all rows are eligible).}

\item{ratio}{Numeric, target ratio of unexposed to exposed (default: 2,
meaning 2 unexposed for every 1 exposed).}

\item{id_var}{Character, name of the ID column for reporting (default: NULL).}

\item{seed}{Integer, random seed for reproducibility (default: NULL).}

\item{mark_unsampled}{Character, how to mark unsampled unexposed individuals:
"na" sets exposure to NA, "drop" removes rows, "flag" adds a column
(default: "na").}
}
\value{
The input data.table, modified:
  \itemize{
    \item If `mark_unsampled = "na"`: unsampled unexposed have exposure set to NA
    \item If `mark_unsampled = "drop"`: unsampled unexposed rows are removed
    \item If `mark_unsampled = "flag"`: adds `sampled` column (TRUE/FALSE)
  }
}
\description{
Samples unexposed individuals to achieve a target ratio relative to exposed
individuals. This is commonly used in target trial emulation to increase
statistical efficiency while maintaining reasonable sample sizes.
}
\details{
In observational studies, there are often many more unexposed than exposed
individuals. Including all unexposed can be computationally expensive and
adds little statistical power beyond a certain ratio. Common choices are
1:1, 2:1, or 4:1 matching.

The function:
\enumerate{
  \item Counts exposed individuals among eligible rows
  \item Randomly samples `ratio * n_exposed` from eligible unexposed
  \item Marks or removes unsampled unexposed individuals
}

If there are fewer unexposed than `ratio * n_exposed`, all unexposed are kept.
}
\examples{
library(data.table)
set.seed(42)
dt <- data.table(
  id = 1:1000,
  eligible = TRUE,
  exposed = c(rep(TRUE, 100), rep(FALSE, 900))
)
# 2:1 matching: keep 200 unexposed for 100 exposed
result <- tte_match_ratio(dt, "exposed", "eligible", ratio = 2, seed = 123)
table(result$exposed, useNA = "always")

}
\concept{tte_design}
