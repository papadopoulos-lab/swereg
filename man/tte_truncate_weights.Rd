% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tte_weights.R
\name{tte_truncate_weights}
\alias{tte_truncate_weights}
\title{Truncate extreme inverse probability weights}
\usage{
tte_truncate_weights(
  data,
  weight_cols,
  lower = 0.01,
  upper = 0.99,
  suffix = "_trunc"
)
}
\arguments{
\item{data}{A data.table containing the weight columns to truncate.}

\item{weight_cols}{Character vector of column names containing weights to
truncate.}

\item{lower}{Numeric, lower quantile cutoff (default: 0.01 for 1st percentile).}

\item{upper}{Numeric, upper quantile cutoff (default: 0.99 for 99th percentile).}

\item{suffix}{Character, suffix to append to column names for truncated weights
(default: "_trunc").}
}
\value{
The input data.table with added columns for truncated weights. Column
  names follow the pattern \code{original_col + suffix}.
}
\description{
Truncates weights at specified quantiles to reduce variance inflation from
extreme values. This is a common practice in causal inference to balance
the bias-variance tradeoff when using inverse probability weights.
}
\details{
Weight truncation addresses the variance inflation that can occur with
inverse probability weights. Extreme weights (very large or very small)
can dramatically increase the variance of effect estimates. Truncating
at the 1st and 99th percentiles is a common choice that typically
introduces minimal bias while substantially reducing variance.

The function calculates quantiles across all non-NA values in each column,
then clips values outside these bounds to the boundary values.
}
\examples{
library(data.table)
dt <- data.table(
  id = 1:100,
  ipw = c(0.1, rep(1, 98), 10),  # Extreme values at ends
  ipcw = runif(100, 0.5, 2)
)
result <- tte_truncate_weights(dt, weight_cols = c("ipw", "ipcw"))
# Creates ipw_trunc and ipcw_trunc columns

}
\seealso{
\code{\link{tte_calculate_ipw}}, \code{\link{tte_calculate_ipcw}}

Other tte_weights: 
\code{\link{tte_calculate_ipcw}()},
\code{\link{tte_calculate_ipw}()},
\code{\link{tte_combine_weights}()},
\code{\link{tte_identify_censoring}()}
}
\concept{tte_weights}
