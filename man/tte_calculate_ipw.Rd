% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tte_weights.R
\name{tte_calculate_ipw}
\alias{tte_calculate_ipw}
\title{Calculate inverse probability of treatment weights (IPW)}
\usage{
tte_calculate_ipw(
  data,
  exposure_var,
  confounder_vars,
  id_var = "trial_id",
  stabilize = TRUE
)
}
\arguments{
\item{data}{A data.table with one row per trial at baseline (typically where
`tstart == 0`).}

\item{exposure_var}{Character, name of the binary exposure/treatment column.}

\item{confounder_vars}{Character vector of confounder variable names for
the propensity score model.}

\item{id_var}{Character, name of the trial identifier column
(default: "trial_id").}

\item{stabilize}{Logical, whether to use stabilized weights (recommended,
default: TRUE). Stabilized weights have the marginal probability in the
numerator, reducing variance while maintaining valid inference.}
}
\value{
The input data.table with added columns:
  \describe{
    \item{ps}{Propensity score: P(exposure | confounders)}
    \item{ipw}{Inverse probability weight (stabilized if `stabilize = TRUE`)}
  }
}
\description{
Calculates stabilized inverse probability of treatment weights to adjust
for baseline confounding in target trial emulation. IPW reweights the sample
so that confounders are balanced across treatment groups, creating a
pseudo-population where treatment is independent of measured confounders.
}
\details{
IPW addresses confounding by creating a pseudo-population where treatment
assignment is independent of confounders. The propensity score P(A|L) is
estimated using logistic regression, where A is treatment and L represents
confounders.

**Stabilized weights (recommended):**
\deqn{IPW = \frac{P(A)}{P(A|L)}}
for exposed, and
\deqn{IPW = \frac{1-P(A)}{1-P(A|L)}}
for unexposed.

**Unstabilized weights:**
\deqn{IPW = \frac{1}{P(A|L)}}
for exposed, and
\deqn{IPW = \frac{1}{1-P(A|L)}}
for unexposed.

Stabilized weights are generally preferred because they have lower variance
and the pseudo-population has the same expected size as the original sample.
}
\examples{
library(data.table)
# Create example baseline data
set.seed(42)
baseline <- data.table(
  trial_id = 1:1000,
  exposed = rbinom(1000, 1, 0.3),
  age_cat = sample(1:4, 1000, replace = TRUE),
  education = sample(1:3, 1000, replace = TRUE)
)
# Calculate IPW
result <- tte_calculate_ipw(
  data = baseline,
  exposure_var = "exposed",
  confounder_vars = c("age_cat", "education"),
  id_var = "trial_id"
)
summary(result$ipw)

}
\seealso{
\code{\link{tte_calculate_ipcw}}, \code{\link{tte_combine_weights}}

Other tte_weights: 
\code{\link{tte_calculate_ipcw}()},
\code{\link{tte_combine_weights}()},
\code{\link{tte_identify_censoring}()},
\code{\link{tte_truncate_weights}()}
}
\concept{tte_weights}
