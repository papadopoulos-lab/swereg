% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tte_methods.R
\name{tte_enroll}
\alias{tte_enroll}
\title{Enroll participants into trials with matching and panel expansion}
\usage{
tte_enroll(trial, ...)
}
\arguments{
\item{trial}{A [TTETrial] object with person_week level data.}

\item{...}{Method arguments:
\describe{
  \item{ratio}{Numeric, default 2. Sampling ratio for unexposed:exposed.}
  \item{seed}{Integer or NULL. Random seed for reproducibility.}
  \item{extra_cols}{Character vector of additional columns to include
    beyond design variables (e.g., "isoyearweek").}
}}
}
\value{
The modified [TTETrial] object with trial level data (for chaining).
}
\description{
S7 method that combines sampling (matching unexposed to exposed) and panel
expansion into a single step. This method transitions `data_level` from
"person_week" to "trial".
}
\details{
The method performs two operations:

**1. Matching (sampling)**
- Samples unexposed individuals at the specified ratio relative to exposed
- Uses `eligible_var` from design to identify eligible entries
- Marks sampled rows via `to_include` column

**2. Panel expansion**
- For each `to_include == TRUE` row, extracts `follow_up_time` rows of follow-up
- Creates `trial_id` as `"<person_id>.<row_id>"`
- Carries forward the baseline exposure value
- Creates `trial_week` (0-indexed time within each trial)

Columns included automatically from design:
- `person_id_var` (kept in panel for reference)
- `time_exposure_var` (e.g., "rd_exposed")
- `exposure_var` (baseline, carried forward)
- `confounder_vars`
- `outcome_vars`

If you need to prefix trial_id with file info for batching, do it after
enrollment:
```r
trial <- tte_trial(data, design) |>
  tte_enroll(ratio = 2, seed = 42)
trial@data[, trial_id := paste0(enrollment_id, ".", trial_id)]
```
}
\examples{
\dontrun{
design <- tte_design(
  person_id_var = "id",
  exposure_var = "baseline_exposed",
  time_exposure_var = "rd_exposed",
  outcome_vars = c("death", "hosp"),
  confounder_vars = c("age", "sex"),
  follow_up_time = 156L,
  eligible_var = "eligible"
)

trial <- tte_trial(person_week_data, design) |>
  tte_enroll(ratio = 2, seed = 42, extra_cols = "isoyearweek")
}

}
\seealso{
[tte_match_ratio()] for the underlying sampling function,
  [tte_collapse()] for the next step in the workflow

Other tte_methods: 
\code{\link{tte_collapse}()},
\code{\link{tte_extract}()},
\code{\link{tte_ipcw_pp}()},
\code{\link{tte_ipw}()},
\code{\link{tte_irr}()},
\code{\link{tte_km}()},
\code{\link{tte_prepare_outcome}()},
\code{\link{tte_rates}()},
\code{\link{tte_rbind}()},
\code{\link{tte_summary}()},
\code{\link{tte_table1}()},
\code{\link{tte_truncate}()},
\code{\link{tte_weight_summary}()},
\code{\link{tte_weights}()}
}
\concept{tte_methods}
