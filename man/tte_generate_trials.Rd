% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tte_generate.R
\name{tte_generate_trials}
\alias{tte_generate_trials}
\title{Loop 1: Create trial panels from skeleton files}
\usage{
tte_generate_trials(
  ett,
  files,
  confounder_vars,
  age_groups,
  global_max_isoyearweek,
  process_fn,
  output_dir,
  period_width = 4L,
  impute_fn = tte_impute_confounders,
  n_workers = 3L,
  swereg_dev_path = NULL
)
}
\arguments{
\item{ett}{data.table from tte_grid()}

\item{files}{character vector of skeleton file paths}

\item{confounder_vars}{character vector of confounder column names}

\item{age_groups}{named list mapping group labels to c(min_age, max_age)}

\item{global_max_isoyearweek}{integer administrative censoring boundary}

\item{process_fn}{callback function with signature
function(file_path, design, file_id, age_range, n_threads) returning a TTETrial}

\item{output_dir}{directory for output files}

\item{period_width}{integer collapse period width (default: 4L)}

\item{impute_fn}{imputation callback, or NULL to skip imputation.
Default: [tte_impute_confounders]. Called as
`impute_fn(trial, confounder_vars)`.}

\item{n_workers}{integer number of concurrent subprocesses (default: 3L)}

\item{swereg_dev_path}{path to local swereg dev copy, or NULL for library(swereg)}
}
\description{
For each file_id (follow-up x age group combination), processes all skeleton
files in parallel using callr::r_bg() subprocesses. Each subprocess starts
with a clean OpenMP state, avoiding the fork+data.table segfault problem.
}
\details{
After all files are processed, combines trial objects via tte_rbind +
tte_collapse, optionally imputes missing confounders, and saves raw + imp files.
}
