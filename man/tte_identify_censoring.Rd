% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tte_weights.R
\name{tte_identify_censoring}
\alias{tte_identify_censoring}
\title{Identify protocol deviation and loss to follow-up for per-protocol analysis}
\usage{
tte_identify_censoring(
  data,
  exposure_var,
  baseline_exposure_var,
  id_var = "trial_id",
  tstart_var = "tstart",
  tstop_var = "tstop",
  follow_up_var = NULL,
  admin_censor_var = NULL
)
}
\arguments{
\item{data}{A data.table in counting-process format (one row per person per
time period).}

\item{exposure_var}{Character, name of the time-varying exposure column
(current treatment status at each period).}

\item{baseline_exposure_var}{Character, name of the baseline treatment
assignment column.}

\item{id_var}{Character, name of the trial identifier column
(default: "trial_id").}

\item{tstart_var}{Character, name of the period start time column
(default: "tstart").}

\item{tstop_var}{Character, name of the period end time column
(default: "tstop").}

\item{follow_up_var}{Character, name of the expected follow-up duration
column. If NULL, loss to follow-up is not calculated (default: NULL).}

\item{admin_censor_var}{Character, name of a column indicating the
administrative censoring boundary (e.g., study end date). If NULL,
administrative censoring is not distinguished from loss to follow-up
(default: NULL).}
}
\value{
The input data.table with added columns:
  \describe{
    \item{protocol_deviated}{Logical, TRUE if current exposure differs from
      baseline assignment or is missing (NA)}
    \item{weeks_to_protocol_deviation}{Integer, tstop of first period with
      protocol deviation (NA if never deviated)}
    \item{weeks_to_loss}{Integer, max tstop if loss to follow-up occurred
      (NA otherwise). Only calculated if `follow_up_var` is provided.}
    \item{censored}{Logical, TRUE if protocol_deviated or lost to follow-up}
  }
}
\description{
Detects informative censoring events in longitudinal data for target trial
emulation. Protocol deviation occurs when treatment status changes from
baseline assignment. Loss to follow-up occurs when follow-up ends earlier
than expected (e.g., death, emigration) without administrative censoring.
}
\details{
In per-protocol analysis, participants are censored when they deviate from
their assigned treatment. This function identifies:

**Protocol deviation:**
\itemize{
  \item Exposed at baseline who stop/switch treatment
  \item Unexposed at baseline who start treatment
  \item Missing exposure data (cannot confirm adherence)
}

**Loss to follow-up:**
\itemize{
  \item Follow-up ended before expected duration
  \item No protocol deviation occurred
  \item Not due to administrative censoring (study end)
}

These censoring events are typically informative (related to prognosis) and
require IPCW adjustment for valid per-protocol effect estimation.
}
\examples{
library(data.table)
# Create example counting-process data
dt <- data.table(
  trial_id = rep(1:3, each = 4),
  tstart = rep(0:3, 3),
  tstop = rep(1:4, 3),
  baseline_exposed = rep(c(TRUE, TRUE, FALSE), each = 4),
  current_exposed = c(TRUE, TRUE, FALSE, FALSE,  # Person 1 deviates at week 3
                      TRUE, TRUE, TRUE, TRUE,    # Person 2 adheres
                      FALSE, FALSE, TRUE, TRUE)  # Person 3 deviates at week 3
)
result <- tte_identify_censoring(
  data = dt,
  exposure_var = "current_exposed",
  baseline_exposure_var = "baseline_exposed"
)

}
\seealso{
\code{\link{tte_calculate_ipcw}}

Other tte_weights: 
\code{\link{tte_calculate_ipcw}()},
\code{\link{tte_calculate_ipw}()},
\code{\link{tte_combine_weights}()},
\code{\link{tte_truncate_weights}()}
}
\concept{tte_weights}
