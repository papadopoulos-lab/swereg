% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_diagnoses_and_operations.R
\name{add_diagnoses}
\alias{add_diagnoses}
\title{Add diagnosis data to skeleton}
\usage{
add_diagnoses(
  skeleton,
  dataset,
  id_name,
  diag_type = "both",
  diags = list(icd10_F64_0 = c("F640"), icd10_F64_89 = c("F6489"), icd10_F64_089 =
    c("F640", "F648", "F649"))
)
}
\arguments{
\item{skeleton}{A data.table containing the main skeleton structure created by \code{\link{create_skeleton}}}

\item{dataset}{A data.table containing hospital registry data with diagnosis codes.
Must have columns for person ID, admission date (\code{indatum}), and at least one
diagnosis code column. Expected diagnosis columns after \code{make_lowercase_names()}:
\code{hdia} (main), \code{dia1}/\code{dia2}/etc (secondary), \code{ekod1}/\code{ekod2}/etc
(external causes), \code{icd7*}, \code{icd9*}}

\item{id_name}{Character string specifying the name of the ID variable in the dataset}

\item{diag_type}{Character string specifying which diagnosis types to search:
\itemize{
  \item "both" (default) - Search in main (\code{hdia}), secondary (\code{dia*}),
    external cause (\code{ekod*}), and historical ICD version columns (\code{icd7*}, \code{icd9*})
  \item "main" - Search only in main diagnosis column (\code{hdia})
}}

\item{diags}{Named list of ICD code patterns to search for. Names become variable names in skeleton.
Patterns should NOT include "^" prefix (automatically added). Use exclusions with "!" prefix.
Example: \code{list("depression" = c("F32", "F33"), "anxiety" = c("F40", "F41"))}}
}
\value{
The skeleton data.table is modified by reference with diagnosis variables added.
  New boolean variables are created for each diagnosis pattern, TRUE when diagnosis is present.
}
\description{
Searches for specific ICD diagnosis codes in Swedish hospital registry data
and adds corresponding boolean variables to the skeleton. Can search in main
diagnoses only or both main and secondary diagnoses.
}
\details{
The function searches across different diagnosis code column types based on the
\code{diag_type} parameter:
\itemize{
  \item When \code{diag_type = "both"}: Searches in \code{hdia} (main diagnosis),
    \code{dia1, dia2, ...} (secondary diagnoses), \code{ekod1, ekod2, ...}
    (external cause codes), \code{icd7*} (ICD-7 codes), and \code{icd9*} (ICD-9 codes)
  \item When \code{diag_type = "main"}: Searches only in \code{hdia} (main diagnosis)
}


## Filtering by source (inpatient/outpatient/cancer)

The diagnosis dataset must contain a \code{source} column with valid values
("inpatient", "outpatient", or "cancer"). To track diagnoses separately by source,
filter the dataset before calling this function:

\preformatted{
# Inpatient diagnoses only
inpatient_data <- diagnoses[source == "inpatient"]
add_diagnoses(skeleton, inpatient_data, "lopnr", diags = list(
  "depression_inpatient" = c("F32", "F33")
))

# Outpatient diagnoses only
outpatient_data <- diagnoses[source == "outpatient"]
add_diagnoses(skeleton, outpatient_data, "lopnr", diags = list(
  "depression_outpatient" = c("F32", "F33")
))

# Combined (any source) - default behavior
add_diagnoses(skeleton, diagnoses, "lopnr", diags = list(
  "depression_any" = c("F32", "F33")
))
}
}
\examples{
# Load fake data
data("fake_person_ids", package = "swereg")
data("fake_diagnoses", package = "swereg")
swereg::make_lowercase_names(fake_diagnoses, date_columns = "indatum")

# Create skeleton
skeleton <- create_skeleton(fake_person_ids[1:10], "2020-01-01", "2020-12-31")

# Add diagnoses
diag_patterns <- list(
  "depression" = c("F32", "F33"),
  "anxiety" = c("F40", "F41")
)
add_diagnoses(skeleton, fake_diagnoses, "lopnr", "both", diag_patterns)
}
\seealso{
\code{\link{create_skeleton}} for creating the skeleton structure,
  \code{\link{add_operations}} for surgical procedures,
  \code{\link{add_rx}} for prescription data,
  \code{\link{make_lowercase_names}} for data preprocessing

Other data_integration: 
\code{\link{add_annual}()},
\code{\link{add_cods}()},
\code{\link{add_icdo3s}()},
\code{\link{add_onetime}()},
\code{\link{add_operations}()},
\code{\link{add_rx}()},
\code{\link{add_snomed3s}()},
\code{\link{add_snomedo10s}()}
}
\concept{data_integration}
