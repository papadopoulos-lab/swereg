% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/skeleton_classes.R
\name{skeleton_process}
\alias{skeleton_process}
\title{Process batches through a user-defined function}
\usage{
skeleton_process(skeleton_meta, ...)
}
\arguments{
\item{skeleton_meta}{A [SkeletonMeta] object.}

\item{process_fn}{A function with signature
  `function(batch_data, batch_number, config)` where:
  - `batch_data`: named list from [skeleton_load_rawbatch()]
  - `batch_number`: integer batch index
  - `config`: the [SkeletonConfig] object

  The function can return anything (profiling data.table, NULL, etc.).
  To save skeleton output files, call [skeleton_save()] inside the
  function.}

\item{batches}{Integer vector of batch indices to process, or `NULL`
(default) to process all batches. Useful for test runs, e.g.
`batches = 1:2` to process only the first two batches.}
}
\value{
A list with:
  - `skeleton_meta`: updated [SkeletonMeta] with `skeleton_files` re-scanned
  - `results`: list of `process_fn` return values (one per batch,
    unprocessed slots are `NULL`)
}
\description{
For each batch: loads rawbatch data via [skeleton_load_rawbatch()],
calls `process_fn`, then runs `gc()`. Wraps in
[progressr::with_progress()] for a progress bar.
}
\details{
## Interactive development pattern

Process functions are typically defined in their own R file with
`plnr::is_run_directly()` at the top to enable line-by-line development:

```r
skeleton_create_mht <- function(batch_data, batch_number, config) {
  if (plnr::is_run_directly()) {
    skel_meta <- qs::qread(config@meta_file)
    batch_number <- 1
    batch_data <- skeleton_load_rawbatch(skel_meta, batch_number)
    config <- skel_meta@config
  }
  # ... processing code ...
}
```
}
\examples{
\dontrun{
# Process all batches
result <- skeleton_process(skel_meta, function(batch_data, batch_number, config) {
  batch_data[["lmed"]] <- batch_data[["lmed"]][!produkt \%in\% excluded]
  skeleton_create_mht(batch_data, batch_number, config)
})
qs::qsave(result$skeleton_meta, config@meta_file)

# Test run: process only the first 2 batches
result <- skeleton_process(skel_meta, my_process_fn, batches = 1:2)
}

}
\seealso{
Other skeleton_methods: 
\code{\link{skeleton_delete_rawbatches}()},
\code{\link{skeleton_delete_skeletons}()},
\code{\link{skeleton_load_rawbatch}()},
\code{\link{skeleton_save_rawbatch}()}
}
\concept{skeleton_methods}
