% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tte_weights.R
\name{tte_collapse_periods}
\alias{tte_collapse_periods}
\title{Collapse time intervals to coarser periods}
\usage{
tte_collapse_periods(
  data,
  id_var,
  time_var,
  period_width = 4L,
  first_cols = NULL,
  last_cols = NULL,
  max_cols = NULL,
  sum_cols = NULL
)
}
\arguments{
\item{data}{A data.table in counting-process format with one row per
fine-grained time unit (e.g., week).}

\item{id_var}{Character, name of the trial/person identifier column.}

\item{time_var}{Character, name of the time index column (e.g., week number
within trial, starting at 0).}

\item{period_width}{Integer, number of time units per period (default: 4).}

\item{first_cols}{Character vector, columns to aggregate using first value
(e.g., baseline characteristics, confounders).}

\item{last_cols}{Character vector, columns to aggregate using last value
(e.g., time-varying exposure status).}

\item{max_cols}{Character vector, columns to aggregate using max
(e.g., event indicators - any event in period = 1).}

\item{sum_cols}{Character vector, columns to aggregate using sum
(e.g., counts, default: NULL).}
}
\value{
A data.table with one row per period per trial, containing:
  \describe{
    \item{tstart}{Period start time (period * period_width)}
    \item{tstop}{Period end time (period * period_width + period_width)}
    \item{Aggregated columns}{As specified by first_cols, last_cols, max_cols, sum_cols}
  }
}
\description{
Aggregates fine-grained longitudinal data (e.g., weekly) into coarser time
periods (e.g., 4-week periods) for target trial emulation. This reduces
data size and can improve model stability.
}
\details{
This function implements a common preprocessing step in target trial
emulation where weekly registry data is collapsed to 4-week (monthly)
periods. This:
\itemize{
  \item Reduces dataset size by ~4x (for 4-week periods)
  \item Improves computational efficiency
  \item Can improve model stability with sparse events
}

The aggregation rules are:
\itemize{
  \item \code{first_cols}: Take first value in period (for time-invariant
    or baseline values)
  \item \code{last_cols}: Take last value in period (for time-varying
    status at period end)
  \item \code{max_cols}: Take maximum (for event indicators: any event
    in period counts as event)
  \item \code{sum_cols}: Take sum (for counts)
}
}
\examples{
library(data.table)
# Weekly data for 2 trials, 8 weeks each
dt <- data.table(
  trial_id = rep(1:2, each = 8),
  week = rep(0:7, 2),
  exposed = c(rep(TRUE, 8), rep(FALSE, 8)),
  age = rep(c(55, 60), each = 8),
  event = c(0,0,0,1,0,0,0,0, 0,0,0,0,0,0,1,0)
)
# Collapse to 4-week periods
result <- tte_collapse_periods(
  dt,
  id_var = "trial_id",
  time_var = "week",
  period_width = 4,
  first_cols = c("age"),
  last_cols = c("exposed"),
  max_cols = c("event")
)

}
\seealso{
Other tte_data_prep: 
\code{\link{tte_time_to_event}()}
}
\concept{tte_data_prep}
