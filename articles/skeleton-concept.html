<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Skeleton concept • swereg</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Skeleton concept">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">swereg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">26.2.10</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/skeleton-concept.html">Skeleton concept</a></li>
    <li><a class="dropdown-item" href="../articles/rowdep-rowind-concept.html">Variable types: rowdep vs rowind</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Implementation</h6></li>
    <li><a class="dropdown-item" href="../articles/skeleton1-create.html">Building the data skeleton (skeleton1_create)</a></li>
    <li><a class="dropdown-item" href="../articles/skeleton2-clean.html">Cleaning and deriving variables (skeleton2_clean)</a></li>
    <li><a class="dropdown-item" href="../articles/skeleton3-analyze.html">Batching (skeleton3_analyze)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Cookbooks</h6></li>
    <li><a class="dropdown-item" href="../articles/cookbook-survival-analysis.html">Survival analysis with time-varying covariates</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/papadopoulos-lab/swereg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Skeleton concept</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/papadopoulos-lab/swereg/blob/main/vignettes/skeleton-concept.Rmd" class="external-link"><code>vignettes/skeleton-concept.Rmd</code></a></small>
      <div class="d-none name"><code>skeleton-concept.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="a-structured-approach-to-registry-data-integration">A structured approach to registry data integration<a class="anchor" aria-label="anchor" href="#a-structured-approach-to-registry-data-integration"></a>
</h2>
<p>Creating analysis-ready datasets from health and social registries
requires systematic data engineering that addresses the complexity of
real-world data structures, evolving research questions, and changing
operational definitions. This vignette presents a structured, modular
framework that keeps things simpler and easier to reproduce, whether
you’re doing cross-sectional summaries or high-frequency longitudinal
analyses.</p>
<div class="section level3">
<h3 id="the-challenge">The challenge<a class="anchor" aria-label="anchor" href="#the-challenge"></a>
</h3>
<p>Real-world epidemiological analyses rarely involve simple
two-variable relationships. Consider a typical research question:</p>
<blockquote>
<p>“Estimate the effect of X on Y, adjusted for education, income, sex,
birth country, comorbidity, and time since diagnosis.”</p>
</blockquote>
<p>While conceptually straightforward, implementation presents
significant challenges:</p>
<ul>
<li>
<em>Education</em> is recorded yearly in administrative databases,
but you want the level “on the date of diagnosis.”</li>
<li>
<em>Comorbidity</em> might require scanning all inpatient and
outpatient ICD codes across 10+ years to build a Charlson index.</li>
<li>
<em>Time since diagnosis</em> requires identifying the first
occurrence of a disease and aligning everything to that timeline.</li>
<li>
<em>Income</em> needs to be inflation-adjusted and
household-weighted.</li>
</ul>
<p>Each variable requires complex data operations including multiple
joins, filters, date comparisons, and aggregation procedures.</p>
<p>A common approach involves constructing a wide person-level dataset
with pre-calculated variables (one record per person). This method
functions adequately for static analyses but becomes problematic when
research requirements evolve—such as stratification by calendar year,
incorporation of time-varying covariates, or implementation of exposure
lags.</p>
<p>Such modifications often require substantial dataset
reconstruction.</p>
</div>
<div class="section level3">
<h3 id="the-skeleton-framework">The skeleton framework<a class="anchor" aria-label="anchor" href="#the-skeleton-framework"></a>
</h3>
<p>Rather than constructing the complete dataset simultaneously, this
approach begins with a structural <em>skeleton</em>.</p>
<p>The skeleton is a long-format table that defines the analytical unit:
one observation per person per time period (e.g., one row per person per
week). This provides the temporal foundation for subsequent data
integration. For example:</p>
<table class="table">
<thead><tr class="header">
<th>id</th>
<th>isoyearweek</th>
<th>isoyear</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>100001</td>
<td>2010-01</td>
<td>2010</td>
</tr>
<tr class="even">
<td>100001</td>
<td>2010-02</td>
<td>2010</td>
</tr>
<tr class="odd">
<td>100001</td>
<td>2010-03</td>
<td>2010</td>
</tr>
<tr class="even">
<td>100002</td>
<td>2009-52</td>
<td>2009</td>
</tr>
<tr class="odd">
<td>100002</td>
<td>2010-01</td>
<td>2010</td>
</tr>
</tbody>
</table>
<p>This structure contains:</p>
<ul>
<li>One observation per person-time combination within the analytical
window</li>
<li>No exposure, outcome, or covariate data initially</li>
<li>Both weekly (isoyearweek) and yearly (isoyear) time units for
flexible temporal aggregation</li>
</ul>
<p>The temporal resolution (weekly, monthly, or daily) depends on
analytical requirements. For most registry-based epidemiological
studies, weekly resolution provides an optimal balance between precision
and computational efficiency.</p>
<p>Following skeleton construction, data are systematically integrated
through sequential operations. This includes:</p>
<ul>
<li>
<strong>Outcomes</strong>: Binary indicators for events of interest
(e.g., myocardial infarction occurrence)</li>
<li>
<strong>Exposures</strong>: Treatment or intervention status (e.g.,
vaccination, hospitalization, benefit receipt)</li>
<li>
<strong>Covariates</strong>: Time-fixed (e.g., sex),
semi-time-varying (e.g., annual income), or high-resolution (e.g., new
diagnoses)</li>
</ul>
<p>Each data component is integrated through separate pipeline
operations using standardized joins and transformations. This modular
approach provides several advantages:</p>
<ul>
<li>Individual steps can be executed, debugged, or modified
independently</li>
<li>Data provenance remains transparent throughout the process</li>
<li>The original temporal structure is preserved</li>
</ul>
<p>When person-level aggregation is required for specific analyses
(e.g., logistic regression, baseline tables), the skeleton can be
collapsed at the final stage.</p>
</div>
<div class="section level3">
<h3 id="temporal-data-classification">Temporal data classification<a class="anchor" aria-label="anchor" href="#temporal-data-classification"></a>
</h3>
<p>The skeleton framework accommodates three distinct temporal patterns
in registry data:</p>
<div class="section level4">
<h4 id="time-invariant-data-demographics-baseline-characteristics">1. Time-invariant data (demographics, baseline characteristics)<a class="anchor" aria-label="anchor" href="#time-invariant-data-demographics-baseline-characteristics"></a>
</h4>
<p>Variables that remain constant are propagated to <strong>all temporal
observations</strong> for each individual:</p>
<ul>
<li>Sex assigned at birth, birth country, genetic markers</li>
</ul>
</div>
<div class="section level4">
<h4 id="periodically-updated-data-socioeconomic-status-family-structure">2. Periodically updated data (socioeconomic status, family
structure)<a class="anchor" aria-label="anchor" href="#periodically-updated-data-socioeconomic-status-family-structure"></a>
</h4>
<p>Variables with regular update cycles are applied to <strong>all
observations within the relevant period</strong>:</p>
<ul>
<li>Annual income from tax records</li>
<li>Family composition, marital status</li>
<li>Education level (with potential temporal variation)</li>
<li>Employment status</li>
</ul>
</div>
<div class="section level4">
<h4 id="event-based-data-diagnoses-prescriptions-deaths">3. Event-based data (diagnoses, prescriptions, deaths)<a class="anchor" aria-label="anchor" href="#event-based-data-diagnoses-prescriptions-deaths"></a>
</h4>
<p>Variables tied to specific occurrences are assigned to
<strong>temporal periods when events occurred</strong>:</p>
<ul>
<li>Hospital admissions and diagnoses</li>
<li>Prescription dispensing dates</li>
<li>Surgical procedures</li>
<li>Death dates and causes</li>
</ul>
<p>These three categories handle the different ways registry data
changes over time.</p>
</div>
</div>
<div class="section level3">
<h3 id="methodological-advantages">Methodological advantages<a class="anchor" aria-label="anchor" href="#methodological-advantages"></a>
</h3>
<p>This approach has practical benefits:</p>
<ul>
<li>
<strong>Enhanced data quality verification</strong>: Follow-up
discontinuation is immediately apparent through missing temporal
observations.</li>
<li>
<strong>Flexible analytical modifications</strong>: Exposure
redefinition or temporal lags require modification of only the relevant
processing layer.</li>
<li>
<strong>Native time-varying covariate support</strong>: Variables
with different temporal resolutions (annual income, daily prescriptions)
can be integrated through appropriate temporal joins.</li>
<li>
<strong>Multiple outcome compatibility</strong>: The skeleton
structure supports simultaneous analysis of multiple endpoints.</li>
</ul>
<p><strong>Application example:</strong> Consider modeling sickness
absence following COVID-19 infection. The skeleton would span
person-weeks from March 2020 to December 2022, with sequential
integration of:</p>
<ul>
<li>Positive COVID-19 test dates from laboratory databases</li>
<li>Inpatient diagnoses from hospital registers</li>
<li>Sickness absence benefits from social insurance records</li>
<li>Income and education from administrative data</li>
<li>Age calculated dynamically by follow-up date</li>
<li>Outcome variable: weekly sickness absence status (binary)</li>
</ul>
<p>The resulting structure supports multiple analytical approaches
including time-to-event models, generalized estimating equations,
fixed-effects regressions, or conditional logistic regression—depending
on temporal aggregation and variable encoding strategies.</p>
</div>
<div class="section level3">
<h3 id="the-three-stage-swereg-workflow">The three-stage swereg workflow<a class="anchor" aria-label="anchor" href="#the-three-stage-swereg-workflow"></a>
</h3>
<p>swereg implements this skeleton concept through three distinct
stages:</p>
<div class="section level4">
<h4 id="stage-1-skeleton1_create-data-integration">Stage 1: skeleton1_create (data integration)<a class="anchor" aria-label="anchor" href="#stage-1-skeleton1_create-data-integration"></a>
</h4>
<ul>
<li>Create the time-structured skeleton</li>
<li>Add raw registry data sequentially (demographics, diagnoses,
prescriptions, etc.)</li>
<li>Apply data standardization and medical code pattern matching</li>
<li>Result: Raw data integrated into time structure</li>
</ul>
</div>
<div class="section level4">
<h4 id="stage-2-skeleton2_clean-data-cleaning">Stage 2: skeleton2_clean (data cleaning)<a class="anchor" aria-label="anchor" href="#stage-2-skeleton2_clean-data-cleaning"></a>
</h4>
<ul>
<li>Load skeleton1_create output</li>
<li>Clean variables and create derived indicators</li>
<li>Apply quality filters and validation rules</li>
<li>Create composite variables and person-level summaries</li>
<li>Result: Clean, analysis-ready variables</li>
</ul>
</div>
<div class="section level4">
<h4 id="stage-3-skeleton3_analyze-analysis-preparation">Stage 3: skeleton3_analyze (analysis preparation)<a class="anchor" aria-label="anchor" href="#stage-3-skeleton3_analyze-analysis-preparation"></a>
</h4>
<ul>
<li>Load skeleton2_clean output</li>
<li>Aggregate weekly data to yearly (or other time units) as needed</li>
<li>Create final analysis datasets optimized for specific research
questions</li>
<li>Implement memory-efficient processing for large populations</li>
<li>Result: Final analysis datasets</li>
</ul>
<p>Each stage is self-contained and can be debugged, modified, or rerun
independently.</p>
</div>
</div>
<div class="section level3">
<h3 id="software-implementation">Software implementation<a class="anchor" aria-label="anchor" href="#software-implementation"></a>
</h3>
<p>The <code>swereg</code> package provides functions for:</p>
<ul>
<li>Defining temporal skeletons for populations with specified follow-up
periods</li>
<li>Integrating and aggregating registry data within the skeleton
framework</li>
<li>Calculating exposures and outcomes from ICD, ATC, and other medical
classification codes</li>
<li>Performing temporal alignment (e.g., identifying income or education
closest to diagnosis dates)</li>
<li>Managing temporal relationships and calendar-year linkages</li>
</ul>
<p>The package ensures:</p>
<ul>
<li>Consistent temporal handling (ISO week standardization, partial
overlap logic)</li>
<li>Transparent operational definitions (e.g., “hospital admission”
criteria)</li>
<li>Methodological reproducibility across research projects and
teams</li>
</ul>
<p>This standardized approach reduces repetitive data processing tasks,
so you can focus on analysis instead of data plumbing.</p>
</div>
<div class="section level3">
<h3 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h3>
<p>To learn swereg, follow the vignettes in order:</p>
<ol style="list-style-type: decimal">
<li>
<strong>“Building the data skeleton (skeleton1_create)”</strong> -
Learn to create the time structure and integrate raw data</li>
<li>
<strong>“Cleaning and deriving variables (skeleton2_clean)”</strong>
- Learn to clean data and create analysis variables<br>
</li>
<li>
<strong>“Production analysis workflows (skeleton3_analyze)”</strong>
- Learn to create final datasets and handle large-scale processing</li>
</ol>
<p>Each vignette builds on the previous one, showing you how to
implement the skeleton concept in practice.</p>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>High-quality analytical datasets require systematic construction
rather than ad-hoc processing. Registry-based variables are typically
derived through deliberate, transparent transformations rather than
direct extraction. The skeleton framework provides a structure that’s
easy to maintain and debug. The <code>swereg</code> package standardizes
this workflow with functions for common data processing tasks. By
establishing temporal foundations before data integration, you can focus
on analysis instead of data plumbing.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Crafted by <a href="https://www.rwhite.no" class="external-link">Richard Aubrey White</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
